<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AISLAMIENTO CRIOGÉNICO – SISTEMA PUR | FePe – Cryogenic PUR System</title>
<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
<link rel="preconnect" href="https://cdn.jsdelivr.net/npm" crossorigin>
<style>
  :root { --ink:#000; --bg:#fff; }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Arial,"Helvetica Neue",Helvetica,sans-serif;}
  header{padding:16px 20px;border-bottom:2px solid var(--ink);}
  header h1{margin:0 0 4px 0;font-size:20px;letter-spacing:.5px}
  header p{margin:0;font-size:12px;opacity:.9}
  main{display:grid;grid-template-columns:380px 1fr;gap:20px;padding:16px 20px 32px}
  .card{border:1px solid var(--ink);padding:14px;border-radius:4px;background:var(--bg)}
  .card h2{margin:0 0 10px 0;font-size:15px;text-transform:uppercase;letter-spacing:.6px}
  label{display:block;font-size:12px;margin:8px 0 2px}
  input,select{width:100%;box-sizing:border-box;font-size:13px;padding:7px 8px;border:1px solid var(--ink);border-radius:4px;background:var(--bg)}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px 12px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px 12px}
  .actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
  button{padding:10px 12px;border:2px solid var(--ink);background:var(--bg);cursor:pointer;font-weight:700}
  button:active{transform:translateY(1px)}
  canvas{background:var(--bg);border:1px solid var(--ink)}
  .results{font-size:13px;line-height:1.6}
  .muted{opacity:.85}
  footer{padding:12px 20px 24px;border-top:2px solid var(--ink);font-size:11px;display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
  .caption{font-size:12px;margin-top:6px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 12px;}
  @media (max-width: 980px){ main{grid-template-columns:1fr} }
  @media print{
    @page{size:Letter portrait;margin:12mm}
    header,.no-print,footer{display:none!important}
    main{grid-template-columns:1fr;gap:0;padding:0}
    .card{border:none;padding:0}
    canvas{border:1px solid var(--ink)}
  }
</style>
</head>
<body>
<header>
  <h1>=== AISLAMIENTO CRIOGÉNICO – SISTEMA PUR | FePe – Cryogenic PUR System ===</h1>
  <p>Diseño automático de espesor total PUR, número de capas y ubicación de barrera de vapor. Carta 8.5×11 in. Firma: F. Peluffo – Octubre 2025.</p>
</header>

<main>
  <section class="card">
    <h2>Datos de proceso y geometría</h2>
    <div class="grid2">
      <div><label>Nombre del caso</label><input id="nombre" value="Diseño_Columna_24in"/></div>
      <div><label>Longitud L (m)</label><input id="L" type="number" step="0.01" value="1.0"/></div>
      <div><label>Diámetro interno (in)</label><input id="d_in" type="number" step="0.001" value="24"/></div>
      <div><label>Espesor pared metálica (in)</label><input id="t_pared" type="number" step="0.001" value="0.375"/></div>
    </div>
    <div class="grid2">
      <div><label>T fluido (°C)</label><input id="T_in" type="number" step="0.1" value="-160"/></div>
      <div><label>T ambiente (°C)</label><input id="T_out" type="number" step="0.1" value="25"/></div>
      <div><label>h interna (W/m²·K)</label><input id="h_in" type="number" step="1" value="500"/></div>
      <div><label>h externa (W/m²·K)</label><input id="h_out" type="number" step="1" value="10"/></div>
    </div>

    <h2>Propiedades y criterios</h2>
    <div class="grid2">
      <div><label>k acero (W/m·K)</label><input id="k_acero" type="number" step="0.1" value="16"/></div>
      <div><label>Densidad PUR (kg/m³)</label><input id="rho_pur" type="number" step="0.1" value="35"/></div>
      <div><label>a PUR [W/m·K] a 25°C</label><input id="k_a" type="number" step="0.0001" value="0.022"/></div>
      <div><label>b PUR [W/m·K/°C]</label><input id="k_b" type="number" step="0.000001" value="0.00015"/></div>
    </div>

    <div class="grid3">
      <div>
        <label>Modo de diseño</label>
        <select id="modo">
          <option value="rocio">Evitar condensación (T_ext ≥ T_rocio + margen)</option>
          <option value="qmax">Limitar fuga de calor (q ≤ q_max)</option>
        </select>
      </div>
      <div>
        <label>Humedad relativa ambiente φ (0–1)</label>
        <input id="phi" type="number" step="0.01" value="0.6"/>
      </div>
      <div>
        <label>Margen sobre T_rocio (°C)</label>
        <input id="margen" type="number" step="0.1" value="2"/>
      </div>
      <div>
        <label>q_max (W/m) — si aplica</label>
        <input id="qmax" type="number" step="0.1" value="40"/>
      </div>
      <div>
        <label>t PUR mín (in)</label>
        <input id="tmin" type="number" step="0.25" value="0.5"/>
      </div>
      <div>
        <label>t PUR máx (in)</label>
        <input id="tmax" type="number" step="0.25" value="12"/>
      </div>
      <div>
        <label>Incremento (in)</label>
        <input id="step" type="number" step="0.25" value="0.25"/>
      </div>
      <div>
        <label>Espesor máx por capa (in)</label>
        <input id="tcapamax" type="number" step="0.25" value="2.0"/>
      </div>
      <div>
        <label>N° máx de capas</label>
        <input id="ncapamax" type="number" step="1" value="4"/>
      </div>
    </div>

    <div class="actions">
      <button id="btnDisenar">Diseñar espesor PUR</button>
      <button id="btnImprimir" class="no-print">Imprimir (Carta)</button>
      <button id="btnPNG" class="no-print">Descargar PNG</button>
    </div>
    <p class="muted">Criterios: (a) Evitar condensación: se exige T_superficie_externa ≥ T_rocío + margen. (b) Límite de fuga: q ≤ q_max.</p>
  </section>

  <section class="card">
    <h2>Lámina — Perfil de temperatura radial</h2>
    <canvas id="chart" width="1000" height="650" aria-label="Gráfica de temperatura radial"></canvas>
    <div class="caption">Escala radial en pulgadas. Firma: <strong>F. Peluffo – Octubre 2025</strong>.</div>
    <div class="card results" style="margin-top:12px;">
      <h2>Resultados de diseño</h2>
      <div id="out" class="mono"></div>
    </div>
  </section>
</main>

<footer>
  <div>© 2025 FePe – Cryogenic PUR System | Español técnico | Carta 8.5×11 in</div>
  <div>Firma automática en láminas: F. Peluffo – Octubre 2025</div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
const IN_TO_M=0.0254, FT_TO_M=0.3048, W_TO_BTU_H=3.412141633;
const Rconv=(h,r,L)=> h>0? 1/(h*2*Math.PI*r*L) : 0;
const Rcond=(k,r1,r2,L)=> Math.log(r2/r1)/(2*Math.PI*k*L);
const kPUR=(Tc,a,b)=> a + b*(Tc-25.0);
const btuPerHPft = q => q*W_TO_BTU_H/(1/FT_TO_M);
function dewPointC(Tc, phi){ const a=17.27, b=237.7; const alpha=((a*Tc)/(b+Tc))+Math.log(phi); return (b*alpha)/(a-alpha); }

function solveForThickness(inp, t_pur_in){
  const r_in=(inp.d_in*IN_TO_M)/2, r_pared_ext=r_in+inp.t_pared*IN_TO_M, r_PUR_ext=r_pared_ext+t_pur_in*IN_TO_M;
  const Rconv_in=Rconv(inp.h_in,r_in,inp.L), R_pared=(inp.t_pared>0)? Rcond(inp.k_acero,r_in,r_pared_ext,inp.L):0;
  let kpur=kPUR((inp.T_in+inp.T_out)/2, inp.k_a, inp.k_b);
  const Rtotal=kp=> Rconv_in+R_pared+Rcond(kp,r_pared_ext,r_PUR_ext,inp.L)+Rconv(inp.h_out,r_PUR_ext,inp.L);
  for(let i=0;i<24;i++){ const Rtot=Rtotal(kpur), q=(inp.T_in-inp.T_out)/Rtot, RhPUR=Rconv_in+R_pared+Rcond(kpur,r_pared_ext,r_PUR_ext,inp.L);
    const T_PUR_ext=inp.T_in - q*RhPUR, knew=kPUR((inp.T_in+T_PUR_ext)/2, inp.k_a, inp.k_b); if(Math.abs(knew-kpur)<1e-5){kpur=knew;break;} kpur=knew; }
  const Rtot=Rtotal(kpur), qWm=(inp.T_in-inp.T_out)/Rtot, Rconv_out=Rconv(inp.h_out, r_PUR_ext, inp.L), RhastaExtSol=Rtot-Rconv_out, T_ext_sol=inp.T_in - qWm*RhastaExtSol;
  return { qWm, T_ext_sol, r_in, r_pared_ext, r_PUR_ext, kpur, Rconv_in };
}

function designThickness(inp){
  const mode=document.getElementById('modo').value, Tdew=dewPointC(inp.T_out, inp.phi), targetT=Tdew+inp.margen; let best=null;
  for(let t=inp.tmin; t<=inp.tmax+1e-9; t+=inp.step){ const s=solveForThickness(inp, t); const ok=(mode==='rocio')? (s.T_ext_sol>=targetT) : (s.qWm<=inp.qmax); if(ok){ best={t_in:t, ...s}; break; } }
  return {best, Tdew, targetT};
}

function calcularYDisenar(){
  const inp={
    nombre: (document.getElementById('nombre').value.trim()||'Caso'),
    L:+document.getElementById('L').value, d_in:+document.getElementById('d_in').value, t_pared:+document.getElementById('t_pared').value,
    T_in:+document.getElementById('T_in').value, T_out:+document.getElementById('T_out').value, h_in:+document.getElementById('h_in').value, h_out:+document.getElementById('h_out').value,
    k_acero:+document.getElementById('k_acero').value, rho_pur:+document.getElementById('rho_pur').value, k_a:+document.getElementById('k_a').value, k_b:+document.getElementById('k_b').value,
    phi:+document.getElementById('phi').value, margen:+document.getElementById('margen').value, qmax:+document.getElementById('qmax').value,
    tmin:+document.getElementById('tmin').value, tmax:+document.getElementById('tmax').value, step:+document.getElementById('step').value, tcapamax:+document.getElementById('tcapamax').value, ncapamax:+document.getElementById('ncapamax').value
  };

  const res=designThickness(inp), best=res.best; let texto="";
  if(!best){
    texto += "No se encontró un espesor que cumpla el criterio dentro del rango especificado.\n";
    texto += `- Modo: ${document.getElementById('modo').value==='rocio'?'Evitar condensación':'Límite de fuga'}\n`;
    texto += `- Rango evaluado: t = ${inp.tmin} a ${inp.tmax} in (paso ${inp.step} in)\n`;
    texto += `- T_rocío = ${res.Tdew.toFixed(2)} °C; objetivo T_ext ≥ ${res.targetT.toFixed(2)} °C\n`;
    document.getElementById('out').textContent=texto; return;
  }

  const nCapas=Math.min(inp.ncapamax, Math.max(1, Math.ceil(best.t_in/inp.tcapamax)));
  const espesorPorCapa=(best.t_in/nCapas); const capasTxt=Array.from({length:nCapas},(_,i)=>`Capa ${i+1}: ${espesorPorCapa.toFixed(2)} in`).join(" | ");
  const ubicacionBV="Barrera de vapor en el LADO CÁLIDO (exterior), continua bajo la chaqueta de aluminio, con anillos de vapor-stop en discontinuidades/soportes.";

  const area_PUR_m2=Math.PI*(best.r_PUR_ext*best.r_PUR_ext - best.r_pared_ext*best.r_pared_ext);
  const peso_PUR_kg_m=inp.rho_pur*area_PUR_m2, peso_total=peso_PUR_kg_m*inp.L;

  const Np=90, r_vals_m=[]; for(let i=0;i<=Np;i++){ r_vals_m.push(best.r_in + (best.r_PUR_ext - best.r_in)*i/Np); }
  const Tstart=inp.T_in - best.qWm*best.Rconv_in, r_steel_end=best.r_pared_ext, Tvals=new Array(r_vals_m.length).fill(0);
  for(let i=0;i<r_vals_m.length;i++){ const r=r_vals_m[i];
    if(inp.t_pared>0 && r<=r_steel_end){ const frac=Math.log(r/best.r_in)/Math.log(r_steel_end/best.r_in); const dT=best.qWm*Rcond(inp.k_acero,best.r_in,r_steel_end,1.0); Tvals[i]=Tstart - Math.max(0,Math.min(1,frac))*dT; }
    else { const r1=(inp.t_pared>0)? r_steel_end : best.r_in; const frac=Math.log(r/r1)/Math.log(best.r_PUR_ext/r1); const dTsteel=(inp.t_pared>0)? best.qWm*Rcond(inp.k_acero,best.r_in,r_steel_end,1.0):0; const dT=best.qWm*Rcond(best.kpur,r1,best.r_PUR_ext,1.0); Tvals[i]=Tstart - dTsteel - Math.max(0,Math.min(1,frac))*dT; } }
  const r_vals_in=r_vals_m.map(v=>v/IN_TO_M);

  if(window._chart) window._chart.destroy();
  window._chart=new Chart(document.getElementById('chart').getContext('2d'), {
    type:'line',
    data:{ labels:r_vals_in, datasets:[{ label:'Temperatura [°C]', data:Tvals, borderWidth:3, pointRadius:2, tension:0, showLine:true }] },
    options:{ responsive:false, animation:false, scales:{ x:{ title:{display:true,text:'Radio [in]'}, ticks:{maxTicksLimit:12}}, y:{ title:{display:true,text:'Temperatura [°C]'}} }, plugins:{legend:{display:false}, title:{display:true, text:`SECCIÓN TÍPICA – DISEÑO PUR | ${inp.nombre} (t = ${best.t_in.toFixed(2)} in)`}} },
    plugins:[{ id:'firma', afterDraw(c){ const {ctx,chartArea}=c; ctx.save(); ctx.fillStyle='#000'; ctx.font='12px Arial'; ctx.textAlign='right'; ctx.fillText('F. Peluffo – Octubre 2025', chartArea.right, chartArea.bottom+24); ctx.restore(); } }]
  });

  const r_in_in=(inp.d_in/2), r_ext_PUR_in=r_in_in+inp.t_pared+best.t_in;
  texto += `Criterio de diseño: ${document.getElementById('modo').value==='rocio' ? 'Evitar condensación (T_ext ≥ T_rocío + margen)' : 'Límite de fuga (q ≤ q_max)'}\n`;
  texto += `T_amb = ${inp.T_out.toFixed(1)} °C | φ = ${inp.phi.toFixed(2)} → T_rocío = ${res.Tdew.toFixed(2)} °C; objetivo T_ext ≥ ${res.targetT.toFixed(2)} °C\n`;
  texto += `Espesor PUR diseñado (total): ${best.t_in.toFixed(2)} in\n`;
  texto += `N° de capas: ${nCapas} (espesor máx/capa ${inp.tcapamax.toFixed(2)} in) → ${capasTxt}\n`;
  texto += `Ubicación barrera de vapor: ${ubicacionBV}\n`;
  texto += `q = ${best.qWm.toFixed(2)} W/m | ${ (best.qWm*3.412141633/ (1/FT_TO_M)).toFixed(2) } BTU/h·ft\n`;
  texto += `T_superficie externa (sólida, antes de convección) = ${best.T_ext_sol.toFixed(2)} °C\n`;
  texto += `Radios: r_in = ${r_in_in.toFixed(3)} in | r_ext PUR = ${r_ext_PUR_in.toFixed(3)} in\n`;
  texto += `Peso PUR = ${peso_PUR_kg_m.toFixed(3)} kg/m | en L=${inp.L.toFixed(2)} m → ${peso_total.toFixed(3)} kg\n`;
  texto += `Nota: adoptar vapor-stops en discontinuidades, penetraciones y cada 6–9 m según práctica.\n`;
  document.getElementById('out').textContent = texto;
}

document.getElementById('btnDisenar').addEventListener('click', calcularYDisenar);
document.getElementById('btnImprimir').addEventListener('click', ()=>window.print());
document.getElementById('btnPNG').addEventListener('click', ()=>{ const c=document.getElementById('chart'); const a=document.createElement('a'); a.download='lamina_diseno_PUR.png'; a.href=c.toDataURL('image/png'); a.click(); });
window.addEventListener('load', calcularYDisenar);
</script>
</body>
</html>
